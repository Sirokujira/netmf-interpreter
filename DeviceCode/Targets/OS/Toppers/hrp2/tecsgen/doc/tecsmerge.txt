【名前】
  tecsmerge -- TECS テンプレートマージャー

【使用方法】
  % tecsgen [OPTION] gen_dir src_dir
  % tecsgen [OPTION] template_templ.c src_dir

【説明】

TECS テンプレートマージャー tecsmerge は、TECS ジェネレータ tecsgen の
生成したテンプレートファイルから初版のセルタイプコードを生成するか、テ
ンプレートファイルを修正した版のセルタイプコードにマージします。
マージの対象は、セルタイプコードおよびインラインヘッダです。

以下のオプションを指定できます．

  -e  src_dir にマージ後のファイルが存在する場合にのみ、マージを実行し
      ます。他のディレクトリに一部のセルタイプコードが存在する場合に、
      誤って src_dir にテンプレートファイルがコピーされてしまうのを抑
      止します。

  -p port_name
  -p old_port_name:new_port_name

      ポート名を指定します。ポート名を置換する場合には ':' で古い名前と
      新しい名前を連結して指定します。

  -f old_func_name:new_func_name

      関数名の置換を指定します。 ':' で古い名前と新しい名前を連結して
      指定します。-p によりポート名を先行して指定する必要があります。

tecsmerege は "#[<...>]#" と "#[</...>]#" で囲まれるコメントをキーワー
ドを頼りにマージを行います。これらで囲まれたコメントを変更してはなりま
せん。マージの際に、このコメントはマージするテンプレートファイルのもの
が採用されます。
コメントや文字列定数をご認識しないため、実際には行頭からの一致する文字
列を探します。
具体的なキーワードを以下に記します。行頭部分も含めて記します。

  "/* #[<PREAMBLE>]#"
  " * #[</PREAMBLE>]#"

  "/* #[<ENTRY_PORT>]# entry_port_name"
  " * #[</ENTRY_PORT>]#"

  "/* #[<ENTRY_FUNC>]# entry_function_name"
  "{"

  "/* #[<POSTAMBLE>]#"
  " * #[</POSTAMBLE>]#"

キーワードの出現順は検査されます。例えば "#[<ENTRY_PORT>]#" は 
"#[</PREAMBLE>]#" または "{" の直後にのみ出現できます。

関数の本体の開始を表すキーワード " * #[</ENTRY_FUNC>]#" は用いられず、
代わりに "{" が用いられます。これにより、関数頭部の置換が行われます。
もし、" * #[</ENTRY_FUNC>]#" をキーワードとして扱いたいのであれば -o 
または --old-mode をオプションとして指定します。

非受け口関数は、" #[</POSTAMBLE>]#" より後ろに書くようにしてください。
あるいは "#[</PREAMBLE>]#" と最初の "#[<ENTRY_PORT>]#" の間に記述して
ください。

【制限】

1) tecsmerge は、セルタイプに受け口を追加した場合や、シグニチャに関数
が追加された場合に用いることが想定されています。tecsgen を実行するごと
に tecsmerge を実行することは想定されていません。
tecsmerge が意図しない変換を行い、必要な記述を喪失する事態に備えて、バッ
クアップファイルを残しています。

2) セルタイプコードの一部が、他のディレクトリに保管されている場合には、
注意が必要です。tecsgen は、すべてのセルタイプのテンプレートを生成する
ため、他のディレクトリに保管されているセルタイプコードのファイルが、
tecsmerge によってマージ先のディレクトリに作られてしまう可能性がありま
す。Makefile で vpath 指定していると、マージ先ディレクトリのファイルが
優先されて、本来取込まれるべきファイルが取込まれない事態が起こりえます。
コンパイル、リンクは正常に終了しますが、セルタイプコードが空であるため
に機能しません。 -e を指定することで、この誤りを防ぐことができます。

3) tecsmerge のリネーム機能は、コメント部の変更にのみ対応しています。
関数頭部を含め、コメント外の名前を変更しません。

4) tecsmerge は、すべての文字が 1バイト文字であると仮定します。
tecsmerge は、ASCII 文字のみからなるキーワード以外を評価しないため 
EUC, SJIS, UTF-8 のいずれでも機能します。ただしマージ元、マージ先の文
字コードが一致している必要があります。

5) Makefile.templ は tecsmerge の対象外です。

6) "#[<POSTAMBLE>]#", "#[</POSTAMBLE>]#" は tecsgen V1.0.0.7 から出力
されるようになりました。tecsgen V1.0.0.6 までで生成したテンプレートファ
イルには、このキーワードが含まれていません。V1.0.0.7 以降で生成したテ
ンプレートファイルを tecsmerge することで追加されますが、最後尾に付加
されるため、キーワードの位置を調整する必要があります。

7) tecsgen V1.0.0.6 までの不具合に対応するため、以下もキーワードとして
扱います。

  "#[/ENTRY_FUNC>]#"
